{% extends "base.html" %}

{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<a href="{% url 'library:book_list' %}" class="back-link">Back to catalogue</a>

<div class="page-header">
    <h1>{{ book.title }}</h1>
</div>

<div class="detail-card">
    <table>
        <tbody>
            <tr>
                <th>Author</th>
                <td>{{ book.author }}</td>
            </tr>
            <tr>
                <th>ISBN</th>
                <td>{{ book.isbn|default:"N/A" }}</td>
            </tr>
            <tr>
                <th>Genres</th>
                <td>
                    {% for genre in book.genres.all %}
                        <span class="badge badge-genre">{{ genre.name }}</span>
                    {% empty %}
                        <span style="color:var(--text-muted)">â€”</span>
                    {% endfor %}
                </td>
            </tr>
            <tr>
                <th>Total Copies</th>
                <td>{{ book.total_copies }}</td>
            </tr>
            <tr>
                <th>Available</th>
                <td>
                    {% if book.available_copies > 0 %}
                        <span class="badge badge-available">{{ book.available_copies }} / {{ book.total_copies }}</span>
                    {% else %}
                        <span class="badge badge-unavailable">0 / {{ book.total_copies }}</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Added</th>
                <td>{{ book.added_at|date:"N j, Y" }}</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="checkout-area">
    {% if can_checkout %}
        <p style="margin:0; color:var(--text-secondary);">This book is available to check out.</p>
        <form method="post" action="{% url 'library:book_checkout' book.pk %}">
            {% csrf_token %}
            <button type="submit">Check Out</button>
        </form>
    {% elif has_active_loan %}
        <p style="margin:0;">You already have this book checked out.</p>
        <span class="badge badge-active">Currently Checked Out</span>
    {% else %}
        <p style="margin:0;">No copies currently available.</p>
        <span class="badge badge-unavailable">Unavailable</span>
    {% endif %}
</div>
{% endblock %}
